<html>

<head>
    <link rel="stylesheet" href="/node_modules/material-design-lite/material.min.css">
    <script src="/node_modules/material-design-lite/material.min.js"></script>
    <script src="/node_modules/jquery/dist/jquery.min.js"></script>
    <link rel="stylesheet" href="/static/css/material.min.css" />
    <link rel="stylesheet" href="/static/css/style.css" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <script src="static/js/config.js"></script>
    <script src="/static/js/rx.js"></script>
    <script src="https://cdn.firebase.com/libs/firebaseui/2.6.3/firebaseui.js"></script>
  <link type="text/css" rel="stylesheet" href="https://cdn.firebase.com/libs/firebaseui/2.6.3/firebaseui.css" />
  <script src="https://www.gstatic.com/firebasejs/4.12.0/firebase.js"></script>
<script>
  // Initialize Firebase
  var config = {
    apiKey: "AIzaSyB10z3XlLFflvuOHCw8cunYQDzhyRqy6bg",
    authDomain: "how-is-it-1521774533551.firebaseapp.com",
    databaseURL: "https://how-is-it-1521774533551.firebaseio.com",
    projectId: "how-is-it-1521774533551",
    storageBucket: "how-is-it-1521774533551.appspot.com",
    messagingSenderId: "211771018156"
  };
  firebase.initializeApp(config);
</script>
</head>
<style>

      /* Always set the map height explicitly to define the size of the div
       * element that contains the map. */
       #map {
        height: 100%;
      }
      /* Optional: Makes the sample page fill the window. */
      html, body {
        height: 100%;
        margin: 0;
        padding: 0;
      }

</style>
<body>

<!--  OAuth modal -->
<div id="firebaseui-auth-container"></div>
<!--  Dialog modal -->
<dialog class="mdl-dialog">
  <div class="mdl-dialog__content">
    <p >
      Please enable Location useage and Refresh the website
    </p>
  </div>
  <div class="mdl-dialog__actions mdl-dialog__actions--full-width">
    <button style="color:rgb(233,30,99);" type="button" class="mdl-button close" >Refresh</button>
  </div>
</dialog>
<!--  OAuth modal -->

        <div class="demo-layout mdl-layout mdl-js-layout mdl-layout--fixed-drawer mdl-layout--fixed-header">
                <header id="header" style="position:absolute;float:left" class="demo-header mdl-layout__header mdl-color--grey-100 mdl-color-text--grey-600">
                  <div class="mdl-layout__header-row">
                    <span class="mdl-layout-title">Home</span>
                    <div class="mdl-layout-spacer"></div>
                    <div class="mdl-textfield mdl-js-textfield mdl-textfield--expandable">
                      <label class="mdl-button mdl-js-button mdl-button--icon" for="search">
                        <i class="material-icons">search</i>
                      </label>
                      <div class="mdl-textfield__expandable-holder">
                        <input class="mdl-textfield__input" type="text" id="search">
                        <label class="mdl-textfield__label" for="search">Enter your query...</label>
                      </div>
                    </div>
                    <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon" id="hdrbtn">
                      <i class="material-icons">more_vert</i>
                    </button>
                    <ul class="mdl-menu mdl-js-menu mdl-js-ripple-effect mdl-menu--bottom-right" for="hdrbtn">
                      <li class="mdl-menu__item">About</li>
                      <li class="mdl-menu__item">Contact</li>
                      <li class="mdl-menu__item">Legal information</li>
                    </ul>
                  </div>
                </header>
                <div id="drawer" class="demo-drawer mdl-layout__drawer mdl-color--blue-grey-900 mdl-color-text--blue-grey-50">
                  <header class="demo-drawer-header">
                    <img id="avatar"src="static/images/ic_account_circle_white_24dp_2x.png" class="demo-avatar">
                    <div class="demo-avatar-dropdown">
                      <span id="avatarText"></span>
                      <div class="mdl-layout-spacer"></div>
                      <button id="accbtn" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
                        <i class="material-icons" role="presentation">arrow_drop_down</i>
                        <span class="visuallyhidden">Accounts</span>
                      </button>
                      <ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="accbtn">
                        <li class="mdl-menu__item"><i class="material-icons">settings</i> &nbsp Setting</li>
        
                        <li id="signoutBtn"class="mdl-menu__item"><i class="material-icons">input</i> &nbsp Sign out</li>
                      </ul>
                    </div>
                  </header>
                  <nav class="demo-navigation mdl-navigation mdl-color--blue-grey-800">
                    <a class="mdl-navigation__link" href=""><i class="mdl-color-text--blue-grey-400 material-icons" role="presentation">home</i>Home</a>
                    <a class="mdl-navigation__link" href=""><i class="mdl-color-text--blue-grey-400 material-icons" role="presentation">inbox</i>Inbox</a>
                    <a class="mdl-navigation__link" href=""><i class="mdl-color-text--blue-grey-400 material-icons" role="presentation">delete</i>Trash</a>
                    <a class="mdl-navigation__link" href=""><i class="mdl-color-text--blue-grey-400 material-icons" role="presentation">report</i>Spam</a>
                    <a class="mdl-navigation__link" href=""><i class="mdl-color-text--blue-grey-400 material-icons" role="presentation">forum</i>Forums</a>
                    <a class="mdl-navigation__link" href=""><i class="mdl-color-text--blue-grey-400 material-icons" role="presentation">flag</i>Updates</a>
                    <a class="mdl-navigation__link" href=""><i class="mdl-color-text--blue-grey-400 material-icons" role="presentation">local_offer</i>Promos</a>
                    <a class="mdl-navigation__link" href=""><i class="mdl-color-text--blue-grey-400 material-icons" role="presentation">shopping_cart</i>Purchases</a>
                    <a class="mdl-navigation__link" href=""><i class="mdl-color-text--blue-grey-400 material-icons" role="presentation">people</i>Social</a>
                    <div class="mdl-layout-spacer"></div>
                    <a class="mdl-navigation__link" href=""><i class="mdl-color-text--blue-grey-400 material-icons" role="presentation">help_outline</i><span class="visuallyhidden">Help</span></a>
                  </nav>
                </div>
                <main id="content" class="mdl-layout__content mdl-color--grey-100">

                       

                        <div id="loader" class="layout__loader">
                                <div  style ="margin-left: 40%;
                                margin-top: 30%;
                                zoom: 6;
                                position: absolute;" >
                                    <div id="spin" class="mdl-spinner mdl-js-spinner is-active"style=""></div>
                                     
                                </div>
                        </div>
                        
                        <div id="map"></div>

                    
                 </main>




</body>
<script>

var signout = $("#signoutBtn");
signout.bind('click',function(){
    firebase.auth().signOut();
});
    
// Note: This example requires that you consent to location sharing when
      // prompted by your browser. If you see the error "The Geolocation service
      // failed.", it means you probably did not give permission for the browser to
      // locate you.
      var map, infoWindow;
      function initMap() {

         var styledMapType = new google.maps.StyledMapType(
            [
              {elementType: 'geometry', stylers: [{color: '#ebe3cd'}]},
              {elementType: 'labels.text.fill', stylers: [{color: '#523735'}]},
              {elementType: 'labels.text.stroke', stylers: [{color: '#f5f1e6'}]},
              {
                featureType: 'administrative',
                elementType: 'geometry.stroke',
                stylers: [{color: '#c9b2a6'}]
              },
              {
                featureType: 'administrative.land_parcel',
                elementType: 'geometry.stroke',
                stylers: [{color: '#dcd2be'}]
              },
              {
                featureType: 'administrative.land_parcel',
                elementType: 'labels.text.fill',
                stylers: [{color: '#ae9e90'}]
              },
              {
                featureType: 'landscape.natural',
                elementType: 'geometry',
                stylers: [{color: '#dfd2ae'}]
              },
              {
                featureType: 'poi',
                elementType: 'geometry',
                stylers: [{color: '#dfd2ae'}]
              },
              {
                featureType: 'poi',
                elementType: 'labels.text.fill',
                stylers: [{color: '#93817c'}]
              },
              {
                featureType: 'poi.park',
                elementType: 'geometry.fill',
                stylers: [{color: '#a5b076'}]
              },
              {
                featureType: 'poi.park',
                elementType: 'labels.text.fill',
                stylers: [{color: '#447530'}]
              },
              {
                featureType: 'road',
                elementType: 'geometry',
                stylers: [{color: '#f5f1e6'}]
              },
              {
                featureType: 'road.arterial',
                elementType: 'geometry',
                stylers: [{color: '#fdfcf8'}]
              },
              {
                featureType: 'road.highway',
                elementType: 'geometry',
                stylers: [{color: '#f8c967'}]
              },
              {
                featureType: 'road.highway',
                elementType: 'geometry.stroke',
                stylers: [{color: '#e9bc62'}]
              },
              {
                featureType: 'road.highway.controlled_access',
                elementType: 'geometry',
                stylers: [{color: '#e98d58'}]
              },
              {
                featureType: 'road.highway.controlled_access',
                elementType: 'geometry.stroke',
                stylers: [{color: '#db8555'}]
              },
              {
                featureType: 'road.local',
                elementType: 'labels.text.fill',
                stylers: [{color: '#806b63'}]
              },
              {
                featureType: 'transit.line',
                elementType: 'geometry',
                stylers: [{color: '#dfd2ae'}]
              },
              {
                featureType: 'transit.line',
                elementType: 'labels.text.fill',
                stylers: [{color: '#8f7d77'}]
              },
              {
                featureType: 'transit.line',
                elementType: 'labels.text.stroke',
                stylers: [{color: '#ebe3cd'}]
              },
              {
                featureType: 'transit.station',
                elementType: 'geometry',
                stylers: [{color: '#dfd2ae'}]
              },
              {
                featureType: 'water',
                elementType: 'geometry.fill',
                stylers: [{color: '#b9d3c2'}]
              },
              {
                featureType: 'water',
                elementType: 'labels.text.fill',
                stylers: [{color: '#92998d'}]
              }
            ],
            {name: 'Styled Map'});




        map = new google.maps.Map(document.getElementById('map'), {
          center: {lat: -34.397, lng: 150.644},
          zoom: 13,
          mapTypeControlOptions: {
            mapTypeIds: ['roadmap', 'satellite', 'hybrid', 'terrain',
                    'styled_map']
          }
      
        });
        infoWindow = new google.maps.InfoWindow;
        //Associate the styled map with the MapTypeId and set it to display.
        map.mapTypes.set('styled_map', styledMapType);
        map.setMapTypeId('styled_map');

        var trafficLayer = new google.maps.TrafficLayer();
        trafficLayer.setMap(map);
        // Try HTML5 geolocation.
        if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(function(position) {
            var pos = {
              lat: position.coords.latitude,
              lng: position.coords.longitude
            };


            //hide Loader 
            if(firebase.auth().currentUser){
                document.getElementById('loader').style = "display:none" ;
                infoWindow.setPosition(pos);
                infoWindow.setContent('Location found.');
                infoWindow.open(map);
                map.setCenter(pos);
            }else{
                document.getElementById('spin').style="display:none"
            }
            
          }, function() {
            handleLocationError(true, infoWindow, map.getCenter());
          });
        } else {
          // Browser doesn't support Geolocation
          handleLocationError(false, infoWindow, map.getCenter());
        }
      }

      function handleLocationError(browserHasGeolocation, infoWindow, pos) {


        // Fail 
        
        dialog.showModal();





        infoWindow.setPosition(pos);
        infoWindow.setContent(browserHasGeolocation ?
                              'Error: The Geolocation service failed.' :
                              'Error: Your browser doesn\'t support geolocation.');
        infoWindow.open(map);
      }





</script>
  <script type="text/javascript">
    // FirebaseUI config.
    var uiConfig = {
      signInOptions: [
        // Leave the lines as is for the providers you want to offer your users.
        firebase.auth.EmailAuthProvider.PROVIDER_ID
    
      ],signInSuccessUrl:'/'


      , callbacks: {
        signInSuccessUrl: function(currentUser, credential, redirectUrl){


            return true;
            }

      },
      // Terms of service url.
      tosUrl: '/'
    };

    // Initialize the FirebaseUI Widget using Firebase.
    var ui = new firebaseui.auth.AuthUI(firebase.auth());
    // The start method will wait until the DOM is loaded.
 
    firebase.auth().onAuthStateChanged(function(user) {
        if (!user) { 

          // login, register modal
            ui.start('#firebaseui-auth-container', uiConfig);
            $('#header').style="display: none;";
            $('#drawer').style="display: none;";
            $('#content').style="margin:0px";
  
            
        }
        else{
          $('#avatarText').innerHTML= user.displayName + " : "+  user.email;
 
        }
    });
    




    // modal 

     var dialog = document.querySelector('dialog');
     
    if (! dialog.showModal) {
      dialogPolyfill.registerDialog(dialog);
    }
   
    dialog.querySelector('.close').addEventListener('click', function() {
    
    });
 
    var Refresh  = Rx.Observable
              .fromEvent(dialog.querySelector('.close'), 'click');

    Refresh.subscribe(e => {
      window.location.href = "/";
      dialog.close();
    });
           
  </script>
<script async defer
src="https://maps.googleapis.com/maps/api/js?key=AIzaSyARzsympbsauRvmUSZIuuDnCtE3G_vI1Z8&callback=initMap">
</script>
</html>